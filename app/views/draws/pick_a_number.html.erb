<h1>Pick a number</h1>
<h2>The smallest uniq picked number will win!</h2>
<div class="row">
  <div class="span7">  
    <div class="row-fluid">
      <table class="table table-bordered">
        <tbody>
      <% @numbers.each_slice(10) do |row| %>
          <tr>
            <% row.each do |i| %>
              <td>
                <%= link_to(i, add_cart_draw_path(:number => i))  %>
              </td>
            <% end %>
          </tr>  
      <% end %>
        </tbody>
      </table>
    </div>
    <div class="row-fluid">
      <div class="span12 center">
        <%= will_paginate @numbers, :inner_window => 0 %>
      </div>
    </div>
  </div>
  <div class="span5">
    <div class="row-fluid">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th colspan="3">Numbers that you have already picked</th>
          </tr>
          <tr>
            <th># Picked</th>
            <th>Unit Price</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% @cartitems_already.each do |item| %>
          <tr>
            <td><%= item.picked_number %></td>
            <td><%= item.unit_price %></td>
            <td></td>
          </tr>
          <% end%>
        </tbody>
      </table>
<% if @draw.join_type == 'questions'%>
<table class="table table-bordered">
  <thead>
    <tr>
      <th colspan="3" style="text-align:center;">Free credits to use</th>
    </tr>
  </thead>
  <tbody>
  <%
    credits = current_user.credits.find(:all, :conditions => "is_used = 'f' and draw_id=" + @draw.id.to_s)
 %>
 
 <% 
    if credits.count == 0
 %>
 <tr>
  <td colspan="3">
    There is no free credits available.
  </td>
 </tr>
 <tr>
   <td colspan="3">
     <div class="span12 center">
       <%= link_to "Try other prizes", root_path, :class => "btn btn-large btn-primary" %>  
     </div>
   </td>
 </tr>
 <% 
  else
  %>
<%
    credits.each do |c|
  %>
    <tr>
      <th><%= c.value %></th>
      <th><%= c.credit_type %></th>
      <th><%= c.is_used %></th>
    </tr>
  <% end %>
  <tr>
    <td colspan="3">
      <div class="span12 center">
        <%= link_to "Use your credit later", root_path, :class => "btn btn-large btn-primary" %>  
      </div>
    </td>
  </tr>
<%end %>
  
  </tbody>
</table>

<% elsif @draw.join_type == 'paid' %>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th colspan="3" style="text-align:center;">Your Basket</th>
          </tr>
          <tr>
            <th># Picked</th>
            <th>Unit Price</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
        <% cart_total = 0 %>
        <% discount = 0 %>
        <% @cartitems.each do |item| %>
          <% cart_total = cart_total + (item.unit_price * item.quantity) %>
          <tr>
            <td><%= item.picked_number %></td>
            <td><%= item.unit_price %></td>
            <td><%= link_to 'Remove', item, confirm: 'Are you sure?', method: :delete %></td>
          </tr>
        <% end %>
        </tbody>
      </table>
      
      <table class="table table-bordered">
        <tbody>
          <tr>
            <td>Full price</td>
            <td><%= cart_total %></td>
          </tr>
          <tr>
            <td>Discount</td>
            <td><%= discount%></td>
          </tr>
          <tr>
            <th>Grand Total</th>
            <td><%= cart_total - discount %></td>
          </tr>
          <tr>
            <td colspan="2">
              <div class="span12 center">
                <%= link_to "Go to Check out", checkout_cart_path(current_cart.id), :class => "btn btn-large btn-primary" %>
                <%= link_to "Try other prizes", root_path, :class => "btn btn-large btn-primary" %>  
              </div>
            </td>
          </tr>
        </tbody>
      </table>
<% end %>
    </div>
    <div class="row-fluid">
    </div>
  </div>
</div>
