<% provide(:title, 'Pick a number') %>

<h1>Pick a number</h1>
<h2>The smallest uniq picked number will win!<%= params[:event_id]%></h2>
<div class="row">
  <div class="span7">  
    <div class="row-fluid">
      <table class="table table-bordered">
        <tbody>
      <% @numbers.each_slice(10) do |row| %>
          <tr>
            <% row.each do |i| %>
              <td>
                <%= link_to(i, add_ticket_number_cart_path(:ticket_id => params[:ticket_id], :number => i))  %>
              </td>
            <% end %>
          </tr>  
      <% end %>
        </tbody>
      </table>
    </div>
    <div class="row-fluid">
      <div class="span12 center">
        <%= will_paginate @numbers, :inner_window => 0 %>
      </div>
    </div>
  </div>
  <div class="span5">
    <div class="row-fluid">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th colspan="3">Numbers that you have already picked</th>
          </tr>
          <tr>
            <th># Picked</th>
            <th>Unit Price</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% @tickets_already.each do |item| %>
          <tr>
            <td><%= item.picked_number %></td>
            <td><%= number_to_currency(item.unit_price) %></td>
            <td></td>
          </tr>
          <% end%>
        </tbody>
      </table>

<% if @event.join_type == 'questions'%>
<table class="table table-bordered">
  <thead>
    <tr>
      <th colspan="3" style="text-align:center;">Tickes to use</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>value</th>
      <th>type</th>
      <th>used</th>
    </tr>
    <tr>
      <td colspan="3">
        There is no free tickets available.
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <div class="span12 center">
          <%= link_to "Try other prizes", root_path, :class => "btn btn-large btn-primary" %>  
        </div>
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <div class="span12 center">
          <%= link_to "Use your ticket later", root_path, :class => "btn btn-large btn-primary" %>  
        </div>
      </td>
    </tr>
  </tbody>
</table>

<% elsif @event.join_type == 'paid' %>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th colspan="3" style="text-align:center;">Your Basket</th>
          </tr>
          <tr>
            <th># Picked</th>
            <th>Unit Price</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
        <% cart_total = 0 %>
        <% discount = 0 %>
        <% @tickets.each do |item| %>
          <% cart_total = cart_total + (item.unit_price * item.quantity) %>
          <tr>
            <td><%= item.picked_number %></td>
            <td><%= number_to_currency(item.unit_price) %></td>
            <td><%= link_to 'Remove', item, confirm: 'Are you sure?', method: :delete %></td>
          </tr>
        <% end %>
        </tbody>
      </table>
      
      <table class="table table-bordered">
        <tbody>
          <tr>
            <td>Full price</td>
            <td><%= number_to_currency(cart_total) %></td>
          </tr>
          <tr>
            <td>Discount</td>
            <td><%= number_to_currency(discount)%></td>
          </tr>
          <tr>
            <th>Grand Total</th>
            <td><%= number_to_currency(cart_total - discount) %></td>
          </tr>
          <tr>
            <td colspan="2">
              <div class="span12 center">
                <%= link_to "Go to Check out", checkout_cart_path(current_cart.id), :class => "btn btn-large btn-primary" %>
                <%= link_to "Try other prizes", root_path, :class => "btn btn-large btn-primary" %>  
              </div>
            </td>
          </tr>
        </tbody>
      </table>
<% end %>
    </div>
    <div class="row-fluid">
    </div>
  </div>
</div>
